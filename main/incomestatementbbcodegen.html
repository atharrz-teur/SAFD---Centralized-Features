<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Statement BBCode Generator - SAFD</title>
    <link rel="icon" href="https://i.postimg.cc/V6qpRTsK/SAFD-LOGO-MINI2.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1e1e2f, #111111);
            --card-bg: rgba(255, 255, 255, 0.98);
            --card-text: #2d3436;
            --header-text: #ffffff;
            --mute-text: rgba(255, 255, 255, 0.4);
        }

        [data-theme="light"] {
            --bg-gradient: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            --card-bg: #ffffff;
            --card-text: #2d3436;
            --header-text: #111111;
            --mute-text: rgba(0, 0, 0, 0.5);
        }

        body { 
            background: #0f0c29; 
            background: var(--bg-gradient);
            font-family: 'Plus Jakarta Sans', sans-serif; 
            color: var(--header-text); 
            min-height: 100vh;
            position: relative;
            transition: background 0.3s ease;
        }

        .theme-switch-wrapper {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .theme-switch-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--header-text);
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        .theme-switch-btn:hover { background: rgba(255,255,255,0.2); }

        .back-home-wrapper {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
        }
        .back-home-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--header-text);
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        .back-home-btn:hover { background: rgba(255,255,255,0.2); color: var(--header-text); }

        .bg-animate {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            background: rgba(128, 0, 0, 0.15);
            filter: blur(80px);
            border-radius: 50%;
            animation: move 20s infinite alternate;
        }

        @keyframes move {
            from { transform: translate(0, 0); }
            to { transform: translate(150px, 150px); }
        }

        .header-section {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 0;
            margin-bottom: 40px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 50px;
        }

        .logo-img {
            height: 90px;
            filter: drop-shadow(0 0 15px rgba(255,0,0,0.4));
        }

        .card { 
            background: var(--card-bg); 
            border: none; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); 
            margin-bottom: 30px; 
            color: var(--card-text);
        }

        .card-header { 
            padding: 20px 25px;
            font-weight: 800;
            border-radius: 20px 20px 0 0 !important;
        }

        .header-standard { background: linear-gradient(90deg, #b10000, #a55555); color: white; }
        .header-success { background: linear-gradient(90deg, #0f5132, #198754); color: white; }
        .header-danger { background: linear-gradient(90deg, #842029, #dc3545); color: white; }
        .header-dark { background: linear-gradient(90deg, #212529, #343a40); color: white; }

        .form-label { font-weight: 700; font-size: 0.75rem; color: #636e72; text-transform: uppercase; margin-bottom: 5px; }

        .dynamic-row { 
            margin-bottom: 10px; 
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .remove-btn { 
            background: #fff0f0; 
            color: #dc3545; 
            border: 1px solid #ffcccc; 
            border-radius: 8px;
            height: 38px;
            width: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .remove-btn:hover { background: #dc3545; color: #fff; border-color: #dc3545; }

        #output {
            background: #111;
            color: #7bed9f;
            border-radius: 0 0 20px 20px;
            font-family: 'Fira Code', monospace;
            padding: 20px;
        }

        .btn-generate {
            background: linear-gradient(135deg, #800000, #d63031);
            border: none;
            padding: 18px 50px;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(214, 48, 49, 0.4);
        }

        .btn-reset {
            background: #636e72;
            border: none;
            padding: 18px 30px;
            font-weight: 800;
            border-radius: 50px;
            color: white;
            transition: all 0.2s;
        }

        .btn-reset:hover { background: #2d3436; }

        .signature-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 12px;
            height: 100%;
        }

        .sig-type-toggle {
            font-size: 0.7rem;
            margin-bottom: 10px;
        }

        .copyright {
            padding: 40px;
            text-align: center;
            color: var(--mute-text);
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<div class="back-home-wrapper">
    <a href="index.html" class="back-home-btn">
        <i class="fas fa-arrow-left me-2"></i> Back to Menu
    </a>
</div>

<div class="theme-switch-wrapper">
    <button class="theme-switch-btn" onclick="toggleTheme()" id="themeBtn">
        <i class="fas fa-moon me-2"></i> Dark Mode
    </button>
</div>

<div class="bg-animate">
    <div class="shape" style="width: 500px; height: 500px; top: -100px; left: -100px;"></div>
    <div class="shape" style="width: 400px; height: 400px; bottom: -50px; right: -50px; background: rgba(0,0,128,0.1);"></div>
</div>

<div class="header-section">
    <div class="container">
        <div class="logo-container">
            <img src="img/SAFD.png" alt="Dept Logo" class="logo-img">
            <div class="text-center">
                <h1 class="m-0" style="font-weight: 800; letter-spacing: -1px;">Income Statement BBCode Generator</h1>
                <p class="m-0" style="color: #ff7675; letter-spacing: 3px; font-weight: 600;">SAN ANDREAS FIRE DEPARTMENT</p>
            </div>
            <img src="img/FM.png" alt="Div Logo" class="logo-img">
        </div>
    </div>
</div>

<div class="container pb-5">
    <form id="bbcodeForm">
        <div class="card">
            <div class="card-header header-standard"><i class="fa-solid fa-map-location-dot fa-beat-fade me-2"></i>DISTRICT NAME</div>
            <div class="card-body">
                <label class="form-label">Station / Hospital Name</label>
                <select class="form-select save-data" id="hospitalName">
                    <option value="" disabled selected>Choose your district</option>
                    <option value="Fort Carson Hospital">Fort Carson Hospital</option>
                    <option value="All Saint's General Hospital">All Saint's General Hospital</option>
                    <option value="County General Hospital">County General Hospital</option>
                    <option value="Fire Station 34">Fire Station 34</option>
                    <option value="Fire Station 60">Fire Station 60</option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header header-success"><i class="fa-solid fa-circle-arrow-up fa-beat-fade me-2"></i>INCOME ENTRIES</div>
                    <div class="card-body">
                        <div id="incomeContainer">
                            <div class="dynamic-row d-flex gap-2">
                                <div class="flex-grow-1"><input type="text" class="form-control save-data" placeholder="Description"></div>
                                <div style="width: 140px;"><input type="number" step="0.01" class="form-control save-data" placeholder="0.00"></div>
                                <div class="action-area" style="width: 38px;"></div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-success w-100 mt-3 fw-bold" onclick="addRow('incomeContainer')">
                            <i class="fa-solid fa-plus me-1"></i> ADD NEW INCOME
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header header-danger"><i class="fa-solid fa-circle-arrow-down fa-beat-fade me-2"></i>EXPENDITURE ENTRIES</div>
                    <div class="card-body">
                        <div id="expenditureContainer">
                            <div class="dynamic-row d-flex gap-2">
                                <div class="flex-grow-1"><input type="text" class="form-control save-data" placeholder="Description"></div>
                                <div style="width: 140px;"><input type="number" step="0.01" class="form-control save-data" placeholder="0.00"></div>
                                <div class="action-area" style="width: 38px;"></div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-danger w-100 mt-3 fw-bold" onclick="addRow('expenditureContainer')">
                            <i class="fa-solid fa-plus me-1"></i> ADD NEW EXPENSE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header header-standard"><i class="fa-solid fa-scale-balanced fa-beat-fade me-2"></i>AUDIT VALIDATION</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Previous Balance</label>
                        <div class="input-group">
                            <span class="input-group-text bg-dark text-white">$</span>
                            <input type="number" step="0.01" class="form-control save-data" id="previousBalance" placeholder="0.00">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Evidence Balance Screenshot URL</label>
                        <input type="url" class="form-control save-data" id="proofImageLink" placeholder="Image URL">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header header-dark"><i class="fa-solid fa-book fa-beat-fade me-2"></i>LAST LOG</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3"><label class="form-label">Date</label><input type="text" class="form-control save-data" id="logDate" placeholder="DD/MM/YYYY HH:MM"></div>
                    <div class="col-md-3"><label class="form-label">Officer</label><input type="text" class="form-control save-data" id="logIssuedBy" placeholder="Fullname"></div>
                    <div class="col-md-3"><label class="form-label">Action</label>
                        <select class="form-select save-data" id="logAction"><option value="Deposit">Deposit</option><option value="Withdraw">Withdraw</option></select>
                    </div>
                    <div class="col-md-3"><label class="form-label">Balance</label><input type="number" step="0.01" class="form-control save-data" id="logBalance" placeholder="0.00"></div>
                    <div class="col-12"><label class="form-label">Justification</label><input type="text" class="form-control save-data" id="logReason" placeholder="Purpose..."></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header header-standard"><i class="fa-solid fa-file-signature fa-beat-fade me-2"></i>SIGNATIONS</div>
            <div class="card-body">
                <div class="row g-3">
                    <script>
                        function renderSigInputs(idPrefix, label) {
                            document.write(`
                                <div class="col-md-4">
                                    <div class="signature-box">
                                        <label class="form-label d-block border-bottom pb-1">${label}</label>
                                        <input type="text" class="form-control form-control-sm mb-2 save-data" id="${idPrefix}Name" placeholder="Fullname">
                                        
                                        <div class="btn-group w-100 sig-type-toggle mb-2">
                                            <input type="radio" class="btn-check save-data" name="${idPrefix}Type" id="${idPrefix}TypeImg" value="image" checked onchange="toggleSigView('${idPrefix}')">
                                            <label class="btn btn-outline-secondary btn-sm" for="${idPrefix}TypeImg">Image</label>
                                            <input type="radio" class="btn-check save-data" name="${idPrefix}Type" id="${idPrefix}TypeText" value="text" onchange="toggleSigView('${idPrefix}')">
                                            <label class="btn btn-outline-secondary btn-sm" for="${idPrefix}TypeText">Text</label>
                                        </div>

                                        <div id="${idPrefix}ImgField">
                                            <input type="url" class="form-control form-control-sm save-data" id="${idPrefix}Image" placeholder="Image URL">
                                        </div>

                                        <div id="${idPrefix}TextField" style="display:none;">
                                            <input type="text" class="form-control form-control-sm mb-1 save-data" id="${idPrefix}CustomText" placeholder="E-Signature Text">
                                            <div class="d-flex align-items-center gap-2 mb-2 mt-2">
                                                <input type="color" class="form-control form-control-color form-control-sm save-data" id="${idPrefix}Color" value="#000000">
                                                <div class="d-flex gap-1">
                                                    <div class="form-check m-0"><input class="form-check-input save-data" type="checkbox" id="${idPrefix}Bold"><label class="form-label ms-1">B</label></div>
                                                    <div class="form-check m-0"><input class="form-check-input save-data" type="checkbox" id="${idPrefix}Italic"><label class="form-label ms-1">I</label></div>
                                                    <div class="form-check m-0"><input class="form-check-input save-data" type="checkbox" id="${idPrefix}Under"><label class="form-label ms-1">U</label></div>
                                                </div>
                                            </div>
                                            <div class="row g-1">
                                                <div class="col-7">
                                                    <select class="form-select form-select-sm save-data" id="${idPrefix}Font">
                                                        <option value="default"selected>Default Forum Font</option>
                                                        <option value="vivaldi">Vivaldi</option>
                                                        <option value="times new roman">Times New Roman</option>
                                                        <option value="century gothic">Century Gothic</option>
                                                        <option value="courier new">Courier New</option>
                                                        <option value="georgia">Georgia</option>
                                                    </select>
                                                </div>
                                                <div class="col-5">
                                                    <select class="form-select form-select-sm save-data" id="${idPrefix}Size">
                                                        <option value="50">Tiny</option>
                                                        <option value="85">Small</option>
                                                        <option value="100" selected>Normal</option>
                                                        <option value="150">Large</option>
                                                        <option value="200">Huge</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `);
                        }
                        renderSigInputs('acknowledged', 'Hospital Executive');
                        renderSigInputs('prepared', 'Executive Treasurer');
                        renderSigInputs('director', 'Financial Director');
                    </script>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center gap-3 mt-5 mb-5">
            <button type="button" class="btn btn-reset" onclick="resetData()">
                <i class="fa-solid fa-rotate-left me-2"></i> RESET DATA
            </button>
            <button type="button" class="btn btn-generate text-white px-5" onclick="generateBBCode()">
                PROCESS DATA & GENERATE <i class="fa-solid fa-paper-plane ms-2"></i>
            </button>
        </div>
    </form>

    <div class="card overflow-hidden">
        <div class="card-header header-success d-flex justify-content-between align-items-center">
            <span><i class="fa-solid fa-code fa-beat-fade me-2"></i>BBCODE OUTPUT</span>
            <button class="btn btn-light btn-sm fw-bold" onclick="copyToClipboard()">COPY CODE</button>
        </div>
        <textarea id="output" class="form-control" rows="10" readonly placeholder="Output will appear here..."></textarea>
    </div>

    <div class="copyright">
        &copy; 2026 <strong>San Andreas Fire Department</strong> &bull; Financial Management Division
        <br><small>Developed by Abertforth Zeonathaan - Athar</small>
    </div>
</div>

<script>
    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const targetTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(targetTheme);
    }

    function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('safd_theme', theme);
        const btn = document.getElementById('themeBtn');
        if(theme === 'light') {
            btn.innerHTML = '<i class="fas fa-sun me-2"></i> Light Mode';
        } else {
            btn.innerHTML = '<i class="fas fa-moon me-2"></i> Dark Mode';
        }
    }

    const savedTheme = localStorage.getItem('safd_theme');
    if (savedTheme) {
        setTheme(savedTheme);
    } else {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        setTheme(prefersDark ? 'dark' : 'light');
    }

    const logoMapping = {
        "Fort Carson Hospital": "https://i.imgur.com/CzBfnwR.png",
        "All Saint's General Hospital": "https://i.imgur.com/pW2978r.png",
        "County General Hospital": "https://i.imgur.com/523Aw0c.png",
        "Fire Station 34": "https://i.imgur.com/TYX2Vz3.png",
        "Fire Station 60": "https://i.imgur.com/pzp5YSH.png"
    };

    function toggleSigView(prefix) {
        const type = document.querySelector(`input[name="${prefix}Type"]:checked`).value;
        document.getElementById(`${prefix}ImgField`).style.display = type === 'image' ? 'block' : 'none';
        document.getElementById(`${prefix}TextField`).style.display = type === 'text' ? 'block' : 'none';
    }

    function updateRemoveButtons(containerId) {
        const container = document.getElementById(containerId);
        const rows = container.querySelectorAll('.dynamic-row');
        rows.forEach(row => {
            const actionArea = row.querySelector('.action-area');
            if (rows.length > 1) {
                actionArea.innerHTML = `<div class="remove-btn" onclick="removeRow(this, '${containerId}')"><i class="fa-solid fa-trash-can"></i></div>`;
            } else {
                actionArea.innerHTML = '';
            }
        });
    }

    function addRow(containerId) {
        const container = document.getElementById(containerId);
        const row = document.createElement('div');
        row.className = 'dynamic-row d-flex gap-2';
        row.innerHTML = `
            <div class="flex-grow-1"><input type="text" class="form-control save-data" placeholder="Description"></div>
            <div style="width: 140px;"><input type="number" step="0.01" class="form-control save-data" placeholder="0.00"></div>
            <div class="action-area" style="width: 38px;"></div>
        `;
        container.appendChild(row);
        updateRemoveButtons(containerId);
        bindSaveEvents();
    }

    function removeRow(button, containerId) {
        button.closest('.dynamic-row').remove();
        updateRemoveButtons(containerId);
        saveToLocal();
    }

function getSignatureBB(prefix) {
        const type = document.querySelector(`input[name="${prefix}Type"]:checked`).value;
        if (type === 'image') {
            const url = document.getElementById(`${prefix}Image`).value;
            return url ? `[img]${url}[/img]` : `[i][Not Signed][/i]`;
        } else {
            let text = document.getElementById(`${prefix}CustomText`).value || "Signature";
            const font = document.getElementById(`${prefix}Font`).value;
            const size = document.getElementById(`${prefix}Size`).value;
            const color = document.getElementById(`${prefix}Color`).value;
            const isBold = document.getElementById(`${prefix}Bold`).checked;
            const isItalic = document.getElementById(`${prefix}Italic`).checked;
            const isUnder = document.getElementById(`${prefix}Under`).checked;

            if (isBold) text = `[b]${text}[/b]`;
            if (isItalic) text = `[i]${text}[/i]`;
            if (isUnder) text = `[u]${text}[/u]`;
            
            if (font !== "default") {
                return `[font=${font}][size=${size}][color=${color}]${text}[/color][/size][/font]`;
            } else {
                return `[size=${size}][color=${color}]${text}[/color][/size]`;
            }
        }
    }

    function generateBBCode() {
        saveToLocal();
        const hospitalName = document.getElementById('hospitalName').value || "[DISTRICT NAME]";
        const logoUrl = logoMapping[hospitalName] || ""; 
        const prevBal = parseFloat(document.getElementById('previousBalance').value) || 0;
        
        const incomeRows = Array.from(document.querySelectorAll('#incomeContainer .dynamic-row')).map(row => {
            const inputs = row.querySelectorAll('input');
            return { desc: inputs[0].value || "-", amt: parseFloat(inputs[1].value) || 0 };
        });
        const totalInc = incomeRows.reduce((s, e) => s + e.amt, 0);

        const expenditureRows = Array.from(document.querySelectorAll('#expenditureContainer .dynamic-row')).map(row => {
            const inputs = row.querySelectorAll('input');
            return { desc: inputs[0].value || "-", amt: parseFloat(inputs[1].value) || 0 };
        });
        const totalExp = expenditureRows.reduce((s, e) => s + e.amt, 0);
        const grandTotal = prevBal + (totalInc - totalExp);

        const incBB = incomeRows.map(e => `[tr][td1=white][center][color=black]${e.desc}[/color][/center][td1=white][center]$${e.amt.toFixed(2)}[/center][/td1][/tr]`).join('\n');
        const expBB = expenditureRows.map(e => `[tr][td1=white][center][color=black]${e.desc}[/color][/center][td1=white][center]$${e.amt.toFixed(2)}[/center][/td1][/tr]`).join('\n');

        const bbcode = `[divbox=white]
[divbox=maroon][center][color=transparent][SPACER][/color][/center]
[aligntable=left,185,25,0,0,0,transparent][img-resize=150]${logoUrl}[/img-resize][/aligntable]
[aligntable=#200000;font-family:century gothic;right,0,210,150,0,0,transparent][color=#FFFFFF]
[space][/space]
[b][size=200]${hospitalName}[/size][/b]
[size=150]Income Statement[/size][/color][/aligntable]
[space][/space]
[space][/space]
[center][color=transparent][SPACER][/color][/divbox]
[divbox=white][CENTER][size=200][b][color=maroon][font=times new roman]Income[/font][/color][/b][/size][/CENTER][/divbox]
[center][table]
[tr][td1=maroon][center][b][color=white]Description[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Amount[/color][/b][/center][/td1][/tr]
${incBB}
[tr][td1=maroon][center][color=white]Total Income[/color][/center][td1=white][center]$${totalInc.toFixed(2)}[/center][/td1][/tr]
[/table]
[divbox=white][CENTER][size=200][b][color=maroon][font=times new roman]Expenditure[/font][/color][/b][/size][/CENTER][/divbox]
[center][table]
[tr][td1=maroon][center][b][color=white]Description[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Amount[/color][/b][/center][/td1][/tr]
${expBB}
[tr][td1=maroon][center][color=white]Total Expenditure[/color][/center][td1=white][center]$${totalExp.toFixed(2)}[/center][/td1][/tr]
[/table]
[divbox=white][CENTER][size=200][b][color=maroon][font=times new roman]Current Balance[/font][/color][/b][/size][/CENTER][/divbox]
[center][table]
[tr][td1=maroon][center][b][color=white]Description[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Amount[/color][/b][/center][/td1][/tr]
[tr][td1=white][center][color=black]Previous Balance[/color][/center][td1=white][center]$${prevBal.toFixed(2)}[/center][/td1][/tr]
[tr][td1=white][center][color=black]Net Income[/color][/center][td1=white][center]$${(totalInc - totalExp).toFixed(2)}[/center][/td1][/tr]
[tr][td1=maroon][center][color=white]Grand Total[/color][/center][td1=white][center]$${grandTotal.toFixed(2)}[/center][/td1][/tr]
[/table][hr][/hr]
[Spoiler][img]${document.getElementById('proofImageLink').value || "IMG"}[/img][/spoiler]
[space][/space]
[altspoiler=Last Log][table]
[tr][td1=maroon][center][b][color=white]Date & Time[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Issued By[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Action[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Balance[/color][/b][/center][/td1][td1=maroon][center][b][color=white]Reason[/color][/b][/center][/td1][/tr]
[tr][td1=white][center]${document.getElementById('logDate').value || "-"}[/center][td1=white][center]${document.getElementById('logIssuedBy').value || "-"}[/center][td1=white][center]${document.getElementById('logAction').value}[/center][td1=white][center]$${(parseFloat(document.getElementById('logBalance').value) || 0).toFixed(2)}[/center][td1=white][center]${document.getElementById('logReason').value || "-"}[/center][/tr]
[/table][/altspoiler]
[hr][/hr]
[table][tr][td][center][b]Acknowledged[/b],
Hospital Executive
${getSignatureBB('acknowledged')}
___________________________
[i]${document.getElementById('acknowledgedName').value || "NAME"}[/i][/center][/td]
[td][/td][td][center][b]Prepared[/b],
Head of Treasurer
${getSignatureBB('prepared')}
___________________________
[i]${document.getElementById('preparedName').value || "NAME"}[/i][/center][/td][/tr][/table]
[space][/space]
[center]
[b]Acknowledged & Signed[/b]
Director of Financial Management
${getSignatureBB('director')}
___________________________
${document.getElementById('directorName').value || "NAME"}[/center]
[/divbox]`;

        document.getElementById('output').value = bbcode.trim();
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function copyToClipboard() {
        const output = document.getElementById('output');
        output.select();
        document.execCommand('copy');
        alert('BBCode copied to clipboard!');
    }

    function saveToLocal() {
        const formData = {
            static: {},
            income: [],
            expenditure: []
        };
        document.querySelectorAll('.save-data').forEach(el => {
            if (el.id) {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    formData.static[el.id] = el.checked;
                } else {
                    formData.static[el.id] = el.value;
                }
            }
        });
        document.querySelectorAll('#incomeContainer .dynamic-row').forEach(row => {
            const inputs = row.querySelectorAll('input');
            formData.income.push({ desc: inputs[0].value, amt: inputs[1].value });
        });
        document.querySelectorAll('#expenditureContainer .dynamic-row').forEach(row => {
            const inputs = row.querySelectorAll('input');
            formData.expenditure.push({ desc: inputs[0].value, amt: inputs[1].value });
        });
        localStorage.setItem('safd_financial_data', JSON.stringify(formData));
    }

    function loadFromLocal() {
        const data = JSON.parse(localStorage.getItem('safd_financial_data'));
        if (!data) return;
        for (const id in data.static) {
            const el = document.getElementById(id);
            if (el) {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    el.checked = data.static[id];
                } else {
                    el.value = data.static[id];
                }
            }
        }
        const incContainer = document.getElementById('incomeContainer');
        incContainer.innerHTML = '';
        data.income.forEach((item, index) => {
            addRow('incomeContainer');
            const rows = incContainer.querySelectorAll('.dynamic-row');
            const inputs = rows[index].querySelectorAll('input');
            inputs[0].value = item.desc;
            inputs[1].value = item.amt;
        });
        const expContainer = document.getElementById('expenditureContainer');
        expContainer.innerHTML = '';
        data.expenditure.forEach((item, index) => {
            addRow('expenditureContainer');
            const rows = expContainer.querySelectorAll('.dynamic-row');
            const inputs = rows[index].querySelectorAll('input');
            inputs[0].value = item.desc;
            inputs[1].value = item.amt;
        });
        ['acknowledged', 'prepared', 'director'].forEach(toggleSigView);
        updateRemoveButtons('incomeContainer');
        updateRemoveButtons('expenditureContainer');
    }

    function resetData() {
        if(confirm("Are you sure you want to reset all data? This cannot be undone.")) {
            localStorage.removeItem('safd_financial_data');
            location.reload();
        }
    }

    function bindSaveEvents() {
        document.querySelectorAll('.save-data').forEach(el => {
            el.addEventListener('change', saveToLocal);
            el.addEventListener('input', saveToLocal);
        });
    }

    window.onload = () => {
        loadFromLocal();
        if (document.querySelectorAll('#incomeContainer .dynamic-row').length === 0) addRow('incomeContainer');
        if (document.querySelectorAll('#expenditureContainer .dynamic-row').length === 0) addRow('expenditureContainer');
        bindSaveEvents();
    };

    updateRemoveButtons('incomeContainer');
    updateRemoveButtons('expenditureContainer');
</script>

</body>
</html>